QR分解とは
QR分解とは、行列を直交行列と上三角行列の積に分解する手法です。
式で表すと以下のようになります。

A = QR

ここで、

A は分解したい行列
Q は直交行列
R は上三角行列
QR分解の手法
QR分解の手法には、グラム・シュミットの直交化 を使用する方法があります。

グラム・シュミットの直交化は、線型独立なベクトルを作るための手法です。
この手法を使って得られた線型独立なベクトルを q₁, q₂, ..., qₙ とします。
このベクトルを並べた行列を直交行列 Q とします。

Q = [ q₁, q₂, ..., qₙ ]

また、これらのベクトルを使って上三角行列 R を求めます。

R =
⎡ a₁ᵀq₁ a₂ᵀq₁ ... aₙᵀq₁ ⎤
⎢ 0 a₂ᵀq₂ ... aₙᵀq₂ ⎥
⎢ ... ... ... ... ⎥
⎣ 0 0 ... aₙᵀqₙ ⎦

ここで、 aᵢᵀqⱼ はベクトル aᵢ と qⱼ の内積を表しています。

非正方行列のQR分解
もし行列が正方行列でない場合、行列 A を次のように分割します。

A = [ Q₁ Q₂ ] [ R₁ ]
                [ 0 ]

これにより、非正方行列でもQR分解が可能となります。
QR分解は数値計算において、行列の分解や最小二乗解の計算に広く利用される手法です。

最小二乗問題の定式化
最小二乗問題 A x ≈ b は、
与えられた方程式の解を、次の基準で求める手法です。
ノルムの平方を最小化する形で表現され、次の式で記述されます。

‖b - Ax‖² = ‖b - QRx‖²

解の導出
ベクトル b の射影を考えると、 Ax の射影は C(A)（行列 A の列空間）に含まれます。
この射影によって残差ノルムを次のように表します：

‖b - Ax‖² = ‖b - QRx‖²

さらに、 Q が直交行列であることを利用して、このノルムは次のように変形できます。

‖b - QRx‖² = ‖Qᵀb - Rx‖²

この式の最小化を考えると、以下のように分解できます。

‖Qᵀb - Rx‖² = ‖R₁ x̂ - Q₁ᵀb‖²

このとき、残差がゼロになるように x̂ を選ぶと、以下が成り立ちます：

x̂ = R⁻¹ Qᵀ b

正規方程式による導出
QR分解を使った正規方程式は次のように導出されます。

x̂ = (Aᵀ A)⁻¹ Aᵀ b

ここで、QR分解 A = QR を代入して展開すると、次のようになります：

x̂ = (Rᵀ Qᵀ Q R)⁻¹ Rᵀ Qᵀ b
   = R⁻¹ (Rᵀ)⁻¹ Rᵀ Qᵀ b
   = R⁻¹ Qᵀ b

このようにして、QR分解を用いることで最小二乗解 x̂ を効率的に求めることができます。